<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>R functions as knitr chunks</title>
    <link rel="stylesheet" href="https://robmoss.github.io/css/base.css"/>
    <link rel="stylesheet" href="https://robmoss.github.io/css/syntax-theme.css"/>
    
  </head>
<body><header class="site">
  <nav>
    <ul><li><a title="Home" class="inactive" href="https://robmoss.github.io/"><picture>
            <source srcset="https://robmoss.github.io/images/home.png" media="(prefers-color-scheme: light)"/>
            <source srcset="https://robmoss.github.io/images/dark_home.png" media="(prefers-color-scheme: dark)"/>
            <img alt="Home" src="https://robmoss.github.io/images/home.png"/>
      </picture></a></li><li><a title="Research" class="inactive" href="https://robmoss.github.io/research/"><picture>
            <source srcset="https://robmoss.github.io/images/influenza.png" media="(prefers-color-scheme: light)"/>
            <source srcset="https://robmoss.github.io/images/dark_influenza.png" media="(prefers-color-scheme: dark)"/>
            <img alt="Research" src="https://robmoss.github.io/images/influenza.png"/>
      </picture></a></li><li><a title="Teaching" class="inactive" href="https://robmoss.github.io/teaching/"><picture>
            <source srcset="https://robmoss.github.io/images/teaching.png" media="(prefers-color-scheme: light)"/>
            <source srcset="https://robmoss.github.io/images/dark_teaching.png" media="(prefers-color-scheme: dark)"/>
            <img alt="Teaching" src="https://robmoss.github.io/images/teaching.png"/>
      </picture></a></li><li><a title="Models" class="inactive" href="https://robmoss.github.io/models/"><picture>
            <source srcset="https://robmoss.github.io/images/model.png" media="(prefers-color-scheme: light)"/>
            <source srcset="https://robmoss.github.io/images/dark_model.png" media="(prefers-color-scheme: dark)"/>
            <img alt="Models" src="https://robmoss.github.io/images/model.png"/>
      </picture></a></li><li><a title="Blog" class="inactive" href="https://robmoss.github.io/blog/"><picture>
            <source srcset="https://robmoss.github.io/images/info.png" media="(prefers-color-scheme: light)"/>
            <source srcset="https://robmoss.github.io/images/dark_info.png" media="(prefers-color-scheme: dark)"/>
            <img alt="Blog" src="https://robmoss.github.io/images/info.png"/>
      </picture></a></li></ul>
  </nav>
</header>

  <article class="post">
    
<header>
  <h1>R functions as knitr chunks</h1>
  
    <span class="post meta date">1 Sep 2023</span>
  
  
    â€”
  
  
    
      <a class="tag" href="https://robmoss.github.io/tag/language/">language</a>
    
  
</header>

    <p>In writing an R Markdown document to describe a within-host malaria model that I'm working on, I discovered that <code>knitr::read_chunk()</code> only accepts fixed line numbers and <code># ---- some-label</code> marker comments.
So I've implemented <code>read_function_chunks()</code>, below, which extracts <strong>each top-level function</strong> as a separate chunk, and supports including roxygen documentation comments.</p>
<span id="continue-reading"></span>
<p>Note that it identifies top-level functions with simple regular expressions, but as long as the code is well-formatted this works fine.</p>
<p>You can use this to display the code for each function in an R file:</p>
<pre data-lang="markdown" class="language-markdown z-code"><code class="language-markdown" data-lang="markdown"><span class="z-text z-html z-markdown"><span class="z-meta z-paragraph z-markdown"><span class="z-meta z-code-fence z-definition z-begin z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-begin z-markdown">```</span>{r read_utils, cache = FALSE, include = FALSE}
</span><span class="z-markup z-raw z-code-fence z-markdown-gfm">read_function_chunks(&quot;./R/utils.R&quot;)
</span><span class="z-meta z-code-fence z-definition z-end z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-end z-markdown">```</span>
</span>
</span><span class="z-meta z-paragraph z-markdown"><span class="z-meta z-code-fence z-definition z-begin z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-begin z-markdown">```</span>{r utils-function-name-1}
</span><span class="z-markup z-raw z-code-fence z-markdown-gfm"></span><span class="z-meta z-code-fence z-definition z-end z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-end z-markdown">```</span>
</span>
</span><span class="z-meta z-paragraph z-markdown"><span class="z-meta z-code-fence z-definition z-begin z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-begin z-markdown">```</span>{r utils-function-name-2}
</span><span class="z-markup z-raw z-code-fence z-markdown-gfm"></span><span class="z-meta z-code-fence z-definition z-end z-text z-markdown-gfm"><span class="z-punctuation z-definition z-raw z-code-fence z-end z-markdown">```</span>
</span></span></span></code></pre>
<p>In this example, <code>./R/utils.R</code> should define the functions <code>function_name_1()</code> and <code>function_name_2()</code>.
Note that underscores are replaced by dashes in the chunk names, so that they will work properly when exporting to PDF via LaTeX.</p>
<pre data-lang="R" class="language-R z-code"><code class="language-R" data-lang="R"><span class="z-source z-r"><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> Read top-level functions as chunks into the current knitr session.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@param</span> <span class="z-variable z-parameter z-r">path</span> Path to the R script.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@param</span> <span class="z-variable z-parameter z-r">lines</span> Character vector of lines of code.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@param</span> <span class="z-variable z-parameter z-r">names</span> The function names to read as chunks.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>   By default, all functions are read.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@param</span> <span class="z-variable z-parameter z-r">prefix</span> A prefix for chunk labels.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@param</span> <span class="z-variable z-parameter z-r">roxygen</span> Whether to include roxygen2 comments (if present).
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> <span class="z-keyword z-other z-r">@details</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> You can use this in an R Markdown document to display the code for each
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> function in separate code blocks.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> For example, if the file &quot;my_example.R&quot; contains two functions called
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> &quot;do_one_thing&quot; and &quot;do_another_thing&quot;, and you run the following code in
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> your R Markdown document:
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> ```
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> read_function_chunks(&quot;my_example.R&quot;)
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> ```
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> this will define two chunks called &quot;my-example-do-one-thing&quot; and
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> &quot;my-example-do-another-thing&quot;.
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span>
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> Note that underscores are replaced by dashes, to avoid issues when
</span><span class="z-comment z-line z-roxygen z-r"><span class="z-punctuation z-definition z-comment z-r">#&#39;</span> exporting to PDF via LaTeX.
</span><span class="z-meta z-function z-name z-r"><span class="z-entity z-name z-function z-r">read_function_chunks</span> </span><span class="z-meta z-function z-r"><span class="z-keyword z-operator z-assignment z-r">&lt;-</span> </span><span class="z-meta z-function z-r"><span class="z-storage z-type z-function z-r">function</span></span><span class="z-meta z-function z-parameters z-r"><span class="z-punctuation z-section z-parameters z-begin z-r">(</span><span class="z-variable z-parameter z-r">path</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">lines</span> <span class="z-keyword z-operator z-assignment z-r">=</span> xfun<span class="z-punctuation z-accessor z-colons z-r">::</span><span class="z-meta z-function-call z-name z-r"><span class="z-variable z-function z-r">read_utf8</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>path<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-parameters z-r">,</span>
                                 <span class="z-variable z-parameter z-r">names</span> <span class="z-keyword z-operator z-assignment z-r">=</span> <span class="z-constant z-language z-r">NULL</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">prefix</span> <span class="z-keyword z-operator z-assignment z-r">=</span> <span class="z-constant z-language z-r">NULL</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">roxygen</span> <span class="z-keyword z-operator z-assignment z-r">=</span> <span class="z-constant z-language z-r">TRUE</span><span class="z-punctuation z-section z-parameters z-end z-r">)</span></span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">is.null</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Look for functions defined at the start of a line.
</span>    func_rexp <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>^([a-zA-Z0-9_<span class="z-constant z-character z-escape z-r">\\</span>.]+) &lt;- function<span class="z-constant z-character z-escape z-r">\\</span>(<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span>

    <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Find all matching function definitions.
</span>    matches <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">regmatches</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>lines<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">regexec</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>func_rexp<span class="z-punctuation z-separator z-arguments z-r">,</span> lines<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>

    <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Extract the name of each function.
</span>    names <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">as.character</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">na.exclude</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">sapply</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>matches<span class="z-punctuation z-separator z-arguments z-r">,</span> `[`<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-constant z-numeric z-float z-decimal z-r">2</span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>

  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span> <span class="z-keyword z-operator z-logical z-r">!=</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">unique</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">stop</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>Duplicate function names detected<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>

  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Identify the start and end line of each function chunk.
</span>  chunks <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-variable z-function z-r">find_functions</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>path<span class="z-punctuation z-separator z-arguments z-r">,</span> names<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">lines</span> <span class="z-keyword z-operator z-assignment z-r">=</span> lines<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">prefix</span> <span class="z-keyword z-operator z-assignment z-r">=</span> prefix<span class="z-punctuation z-separator z-arguments z-r">,</span>
                           <span class="z-variable z-parameter z-r">roxygen</span> <span class="z-keyword z-operator z-assignment z-r">=</span> roxygen<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>

  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Pass these details on to knitr.
</span>  knitr<span class="z-punctuation z-accessor z-colons z-r">::</span><span class="z-meta z-function-call z-name z-r"><span class="z-variable z-function z-r">read_chunk</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>path<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">lines</span> <span class="z-keyword z-operator z-assignment z-r">=</span> lines<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">from</span> <span class="z-keyword z-operator z-assignment z-r">=</span> chunks<span class="z-keyword z-accessor z-dollar z-r">$</span>from<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">to</span> <span class="z-keyword z-operator z-assignment z-r">=</span> chunks<span class="z-keyword z-accessor z-dollar z-r">$</span>to<span class="z-punctuation z-separator z-arguments z-r">,</span>
                    <span class="z-variable z-parameter z-r">labels</span> <span class="z-keyword z-operator z-assignment z-r">=</span> chunks<span class="z-keyword z-accessor z-dollar z-r">$</span>labels<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
<span class="z-punctuation z-section z-braces z-end z-r">}</span>

<span class="z-meta z-function z-name z-r"><span class="z-entity z-name z-function z-r">find_functions</span> </span><span class="z-meta z-function z-r"><span class="z-keyword z-operator z-assignment z-r">&lt;-</span> </span><span class="z-meta z-function z-r"><span class="z-storage z-type z-function z-r">function</span></span><span class="z-meta z-function z-parameters z-r"><span class="z-punctuation z-section z-parameters z-begin z-r">(</span><span class="z-variable z-parameter z-r">path</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">names</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">lines</span> <span class="z-keyword z-operator z-assignment z-r">=</span> xfun<span class="z-punctuation z-accessor z-colons z-r">::</span><span class="z-meta z-function-call z-name z-r"><span class="z-variable z-function z-r">read_utf8</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>path<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-parameters z-r">,</span>
                           <span class="z-variable z-parameter z-r">prefix</span> <span class="z-keyword z-operator z-assignment z-r">=</span> <span class="z-constant z-language z-r">NULL</span><span class="z-punctuation z-separator z-parameters z-r">,</span> <span class="z-variable z-parameter z-r">roxygen</span> <span class="z-keyword z-operator z-assignment z-r">=</span> <span class="z-constant z-language z-r">TRUE</span><span class="z-punctuation z-section z-parameters z-end z-r">)</span></span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Find the line on which each function starts.
</span>  start_rexps <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">paste0</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>^<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> names<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span> &lt;- function<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  starts <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">sapply</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>start_rexps<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function z-r"><span class="z-storage z-type z-function z-r">function</span></span><span class="z-meta z-function z-parameters z-r"><span class="z-punctuation z-section z-parameters z-begin z-r">(</span><span class="z-variable z-parameter z-r">rexp</span><span class="z-punctuation z-section z-parameters z-end z-r">)</span></span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">grep</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>rexp<span class="z-punctuation z-separator z-arguments z-r">,</span> lines<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span> <span class="z-keyword z-operator z-logical z-r">!=</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">stop</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>Found <span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span> matches for <span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span>
         <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span> functions<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>
  starts <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">as.numeric</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>

  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Optionally include roxygen comments above each function.
</span>  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span>roxygen<span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-meta z-function z-name z-r"><span class="z-entity z-name z-function z-r">find_roxygen_start</span> </span><span class="z-meta z-function z-r"><span class="z-keyword z-operator z-assignment z-r">&lt;-</span> </span><span class="z-meta z-function z-r"><span class="z-storage z-type z-function z-r">function</span></span><span class="z-meta z-function z-parameters z-r"><span class="z-punctuation z-section z-parameters z-begin z-r">(</span><span class="z-variable z-parameter z-r">fn_line</span><span class="z-punctuation z-section z-parameters z-end z-r">)</span></span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
      ix <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> fn_line <span class="z-keyword z-operator z-arithmetic z-r">-</span> <span class="z-constant z-numeric z-float z-decimal z-r">1</span>
      <span class="z-keyword z-control z-loop z-while z-r">while</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span>ix <span class="z-keyword z-operator z-logical z-r">&gt;</span> <span class="z-constant z-numeric z-float z-decimal z-r">0</span> <span class="z-keyword z-operator z-logical z-r">&amp;&amp;</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">grepl</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>^#&#39;<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> lines<span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-begin z-r">[</span></span><span class="z-meta z-item-access z-r"><span class="z-meta z-item-access z-arguments z-r">ix</span></span><span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-end z-r">]</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
        ix <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> ix <span class="z-keyword z-operator z-arithmetic z-r">-</span> <span class="z-constant z-numeric z-float z-decimal z-r">1</span>
      <span class="z-punctuation z-section z-braces z-end z-r">}</span>
      ix <span class="z-keyword z-operator z-arithmetic z-r">+</span> <span class="z-constant z-numeric z-float z-decimal z-r">1</span>
    <span class="z-punctuation z-section z-braces z-end z-r">}</span>
    starts <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">sapply</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-separator z-arguments z-r">,</span> find_roxygen_start<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>

  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Find the line on which each function ends.
</span>  end_rexp <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>^}$<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span>
  all_ends <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">grep</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>end_rexp<span class="z-punctuation z-separator z-arguments z-r">,</span> lines<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  ends <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">sapply</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function z-r"><span class="z-storage z-type z-function z-r">function</span></span><span class="z-meta z-function z-parameters z-r"><span class="z-punctuation z-section z-parameters z-begin z-r">(</span><span class="z-variable z-parameter z-r">start</span><span class="z-punctuation z-section z-parameters z-end z-r">)</span></span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">min</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>all_ends<span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-begin z-r">[</span></span><span class="z-meta z-item-access z-r"><span class="z-meta z-item-access z-arguments z-r">all_ends <span class="z-keyword z-operator z-logical z-r">&gt;</span> start</span></span><span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-end z-r">]</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>ends<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span> <span class="z-keyword z-operator z-logical z-r">!=</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">stop</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>Found <span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>starts<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span> ends for <span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span>
         <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span> functions<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>
  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">any</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>ends<span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-begin z-r">[</span></span><span class="z-meta z-item-access z-r"><span class="z-meta z-item-access z-arguments z-r"><span class="z-keyword z-operator z-arithmetic z-r">-</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">length</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>ends<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span></span></span><span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-end z-r">]</span></span> <span class="z-keyword z-operator z-logical z-r">&gt;=</span> starts<span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-begin z-r">[</span></span><span class="z-meta z-item-access z-r"><span class="z-meta z-item-access z-arguments z-r"><span class="z-keyword z-operator z-arithmetic z-r">-</span><span class="z-constant z-numeric z-float z-decimal z-r">1</span></span></span><span class="z-meta z-item-access z-r"><span class="z-punctuation z-section z-brackets z-single z-end z-r">]</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">stop</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>Found one or more over-lapping functions<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>

  <span class="z-comment z-line z-number-sign z-r"><span class="z-punctuation z-definition z-comment z-r">#</span> Create a label for each function chunk.
</span>  <span class="z-keyword z-control z-conditional z-if z-r">if</span> <span class="z-punctuation z-section z-parens z-begin z-r">(</span><span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">is.null</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>prefix<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-parens z-end z-r">)</span> <span class="z-punctuation z-section z-braces z-begin z-r">{</span>
    prefix <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">sub</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span><span class="z-constant z-character z-escape z-r">\\</span>.R$<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>-<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">gsub</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>_<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>-<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">basename</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>path<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
  <span class="z-punctuation z-section z-braces z-end z-r">}</span>
  labels <span class="z-keyword z-operator z-assignment z-r">&lt;-</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">paste0</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span>prefix<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-meta z-function-call z-name z-r"><span class="z-support z-function z-r">gsub</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>_<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-string z-quoted z-double z-r"><span class="z-punctuation z-definition z-string z-begin z-r">&quot;</span>-<span class="z-punctuation z-definition z-string z-end z-r">&quot;</span></span><span class="z-punctuation z-separator z-arguments z-r">,</span> names<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span><span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>

  <span class="z-meta z-function-call z-name z-r"><span class="z-storage z-type z-r">list</span></span><span class="z-meta z-function-call z-arguments z-r"><span class="z-punctuation z-section z-arguments z-begin z-r">(</span><span class="z-variable z-parameter z-r">from</span> <span class="z-keyword z-operator z-assignment z-r">=</span> starts<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">to</span> <span class="z-keyword z-operator z-assignment z-r">=</span> ends<span class="z-punctuation z-separator z-arguments z-r">,</span> <span class="z-variable z-parameter z-r">labels</span> <span class="z-keyword z-operator z-assignment z-r">=</span> labels<span class="z-punctuation z-section z-arguments z-end z-r">)</span></span>
<span class="z-punctuation z-section z-braces z-end z-r">}</span>
</span></code></pre>

  </article>
<footer class="site">
    <a href="http://www.ardischeng.com/">icons by ardis</a>&nbsp;/ <a href="https:&#x2F;&#x2F;github.com&#x2F;robmoss&#x2F;robmoss.github.io&#x2F;tree&#x2F;master&#x2F;content/blog&#x2F;2023-09-01-R-functions-as-knitr-chunks.md">source</a></footer>
</body>
</html>
